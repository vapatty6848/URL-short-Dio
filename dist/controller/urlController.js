"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.urlController = void 0;
const tslib_1 = require("tslib");
const express_1 = require("express");
const shortid_1 = (0, tslib_1.__importDefault)(require("shortid"));
const constants_1 = require("../config/constants");
const URL_1 = require("../database/model/URL");
class urlController {
    async shorten(req, res) {
        const { originUrl } = req.body;
        console.log(req.body);
        const hash = shortid_1.default.generate();
        const shortURL = `${constants_1.config.API_URL}/${hash}`;
        res.json({ originUrl, hash, shortURL });
    }
    async redirect(req, res) {
        const { hash } = req.params;
        const url = await URL_1.URLModel.findOne({ hash });
        if (url) {
            express_1.response.redirect(url.originURL);
            return;
        }
        express_1.response.status(400).json({ error: 'URL not found ' });
    }
}
exports.urlController = urlController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXJsQ29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb250cm9sbGVyL3VybENvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLHFDQUFzRDtBQUN0RCxtRUFBOEI7QUFDOUIsbURBQTZDO0FBQzdDLCtDQUFpRDtBQUVqRCxNQUFhLGFBQWE7SUFDZixLQUFLLENBQUMsT0FBTyxDQUFDLEdBQVksRUFBRSxHQUFhO1FBQzdDLE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFBO1FBQzlCLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RCLE1BQU0sSUFBSSxHQUFHLGlCQUFPLENBQUMsUUFBUSxFQUFFLENBQUE7UUFDL0IsTUFBTSxRQUFRLEdBQUcsR0FBRyxrQkFBTSxDQUFDLE9BQU8sSUFBSSxJQUFJLEVBQUUsQ0FBQTtRQUM1QyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUMsQ0FBQyxDQUFBO0lBQ3pDLENBQUM7SUFFTSxLQUFLLENBQUMsUUFBUSxDQUFDLEdBQVksRUFBRSxHQUFhO1FBQzlDLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFBO1FBQzNCLE1BQU0sR0FBRyxHQUFHLE1BQU0sY0FBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUE7UUFFNUMsSUFBSSxHQUFHLEVBQUU7WUFDTCxrQkFBUSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUE7WUFDaEMsT0FBTTtTQUNUO1FBRUQsa0JBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLGdCQUFnQixFQUFFLENBQUMsQ0FBQTtJQUV6RCxDQUFDO0NBQ0o7QUFyQkQsc0NBcUJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVxdWVzdCwgcmVzcG9uc2UsIFJlc3BvbnNlIH0gZnJvbSBcImV4cHJlc3NcIjtcbmltcG9ydCBzaG9ydElkIGZyb20gXCJzaG9ydGlkXCI7XG5pbXBvcnQgeyBjb25maWcgfSBmcm9tIFwiLi4vY29uZmlnL2NvbnN0YW50c1wiO1xuaW1wb3J0IHsgVVJMTW9kZWwgfSBmcm9tIFwiLi4vZGF0YWJhc2UvbW9kZWwvVVJMXCI7XG5cbmV4cG9ydCBjbGFzcyB1cmxDb250cm9sbGVyIHtcbiAgICBwdWJsaWMgYXN5bmMgc2hvcnRlbihyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICBjb25zdCB7IG9yaWdpblVybCB9ID0gcmVxLmJvZHlcbiAgICAgICBjb25zb2xlLmxvZyhyZXEuYm9keSk7XG4gICAgICAgY29uc3QgaGFzaCA9IHNob3J0SWQuZ2VuZXJhdGUoKVxuICAgICAgIGNvbnN0IHNob3J0VVJMID0gYCR7Y29uZmlnLkFQSV9VUkx9LyR7aGFzaH1gXG4gICAgICAgcmVzLmpzb24oeyBvcmlnaW5VcmwsIGhhc2gsIHNob3J0VVJMfSlcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgcmVkaXJlY3QocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgY29uc3QgeyBoYXNoIH0gPSByZXEucGFyYW1zXG4gICAgICAgY29uc3QgdXJsID0gYXdhaXQgVVJMTW9kZWwuZmluZE9uZSh7IGhhc2ggfSlcblxuICAgICAgIGlmICh1cmwpIHtcbiAgICAgICAgICAgcmVzcG9uc2UucmVkaXJlY3QodXJsLm9yaWdpblVSTClcbiAgICAgICAgICAgcmV0dXJuXG4gICAgICAgfVxuXG4gICAgICAgcmVzcG9uc2Uuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnVVJMIG5vdCBmb3VuZCAnIH0pXG5cbiAgICB9XG59XG5cblxuXG5cbi8qIFBhc3NvcyBcbi0gdmVyaWZpY2FyIHNlIGEgdXJsIG7Do28gZXhpc3RlXG4tIGNyaWFyIG8gaGFzaCB1cmxcbi0gc2FsdmFyIGEgdXJsIG5vIGJhbmNvXG4tIHJldG9ybmFyIGEgdXJsIHNhbHZhXG4qL1xuXG5cbi8qIFBhc3NvcyAyIFxuIC0gUGVnYXIgbyBoYXNoIGRhIFVybFxuIC0gRW5jb250cmFyIGEgVXJsIG9yaWdpbmFsIHBlbG8gIGhhc2ggZW5jb250cmFkb1xuIC0gRGlyZWNpb25hciAgcGFyYSBhIFVybCBvcmlnaW5hbCBhIHBhcnRpciBkbyBxdWUgZW5jb250cmFtb3Mgbm8gYmFuY28gZGUgZGFkb3NcblxuKi8iXX0=